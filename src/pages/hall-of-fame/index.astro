---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Hall of Fame Nomination">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8">TAPT Hall of Fame Nomination</h1>
    
    <div class="max-w-2xl mx-auto">
      <form id="nominationForm" class="space-y-6 bg-white p-6 rounded-lg shadow-md">
        <div class="border-b pb-6">
          <h2 class="text-xl font-semibold mb-4">Nominee Information</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
              <input type="text" name="nomineeFirstName" required class="w-full px-3 py-2 border rounded-md" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
              <input type="text" name="nomineeLastName" required class="w-full px-3 py-2 border rounded-md" />
            </div>
          </div>

          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">School District/Organization *</label>
            <input type="text" name="district" required class="w-full px-3 py-2 border rounded-md" />
          </div>

          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Years of Service *</label>
            <input type="number" name="yearsOfService" required min="0" class="w-full px-3 py-2 border rounded-md" />
          </div>
        </div>

        <div class="border-b pb-6">
          <h2 class="text-xl font-semibold mb-4">Nominator Information</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
              <input type="text" name="supervisorFirstName" required class="w-full px-3 py-2 border rounded-md" />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
              <input type="text" name="supervisorLastName" required class="w-full px-3 py-2 border rounded-md" />
            </div>
          </div>

          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
            <input type="email" name="supervisorEmail" required class="w-full px-3 py-2 border rounded-md" />
          </div>

          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
            <input 
              type="tel" 
              name="supervisorPhone" 
              required 
              pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
              placeholder="123-456-7890"
              class="w-full px-3 py-2 border rounded-md" 
            />
          </div>
        </div>

        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"></div>

        <div class="flex justify-end">
          <button 
            type="submit" 
            class="bg-primary-600 text-white px-6 py-2 rounded-md hover:bg-primary-700 transition-colors"
          >
            Submit Nomination
          </button>
        </div>
      </form>
    </div>
  </div>
</Layout>

<script>
  const form = document.getElementById('nominationForm');
  const errorDiv = document.getElementById('error-message');

  // Format phone number as user types
  const phoneInput = form?.querySelector('input[name="supervisorPhone"]');
  phoneInput?.addEventListener('input', (e) => {
    const input = e.target as HTMLInputElement;
    const value = input.value.replace(/\D/g, '');
    if (value.length > 0) {
      if (value.length <= 3) {
        input.value = value;
      } else if (value.length <= 6) {
        input.value = value.slice(0,3) + '-' + value.slice(3);
      } else {
        input.value = value.slice(0,3) + '-' + value.slice(3,6) + '-' + value.slice(6,10);
      }
    }
  });

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (errorDiv) errorDiv.classList.add('hidden');

    const formData = new FormData(e.target as HTMLFormElement);
    const data = {
      nomineeName: formData.get('nomineeFirstName') + ' ' + formData.get('nomineeLastName'),
      district: formData.get('district'),
      yearsOfService: parseInt(formData.get('yearsOfService') as string),
      nominatorName: formData.get('supervisorFirstName') + ' ' + formData.get('supervisorLastName'),
      nominatorEmail: formData.get('supervisorEmail'),
      nominatorPhone: formData.get('supervisorPhone')
    };

    try {
      const response = await fetch('/api/hall-of-fame/nominate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'Failed to submit nomination');
      }

      window.location.href = '/hall-of-fame/success';
    } catch (error) {
      if (errorDiv) {
        errorDiv.textContent = error instanceof Error ? error.message : 'Failed to submit nomination';
        errorDiv.classList.remove('hidden');
        errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
  });
</script>